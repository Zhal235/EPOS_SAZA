services:
  epos-saza:
    build:
      context: .
      dockerfile: Dockerfile
    image: epos-saza-app:latest
    container_name: saza-epos-app
    restart: unless-stopped
    environment:
      APP_NAME: "${APP_NAME:-EPOS_SAZA}"
      APP_ENV: "${APP_ENV:-production}"
      APP_KEY: "${APP_KEY}"
      APP_DEBUG: "${APP_DEBUG:-false}"
      APP_URL: "${APP_URL:-https://epos-simpels.saza.sch.id}"
      LOG_CHANNEL: "stderr"
      DB_CONNECTION: "mysql"
      DB_HOST: "${DB_HOST}"           # host MySQL di saza-network (container name atau IP)
      DB_PORT: "${DB_PORT:-3306}"
      DB_DATABASE: "${DB_DATABASE}"
      DB_USERNAME: "${DB_USERNAME}"
      DB_PASSWORD: "${DB_PASSWORD}"
      BROADCAST_DRIVER: "log"
      CACHE_DRIVER: "redis"
      FILESYSTEM_DISK: "local"
      QUEUE_CONNECTION: "redis"
      SESSION_DRIVER: "redis"
      SESSION_LIFETIME: "120"
      REDIS_HOST: "${REDIS_HOST}"     # host Redis di saza-network (container name atau IP)
      REDIS_PASSWORD: "${REDIS_PASSWORD:-null}"
      REDIS_PORT: "${REDIS_PORT:-6379}"
      VITE_APP_NAME: "${APP_NAME:-EPOS_SAZA}"
    volumes:
      - ./storage/app:/var/www/html/storage/app
      - ./storage/framework/cache:/var/www/html/storage/framework/cache
      - ./storage/framework/sessions:/var/www/html/storage/framework/sessions
      - ./storage/framework/views:/var/www/html/storage/framework/views
      - ./storage/logs:/var/www/html/storage/logs
    networks:
      - saza-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  saza-network:
    external: true
